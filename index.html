<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Zuid by aakoch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <script src="https://code.jquery.com/jquery-2.2.3.min.js" integrity="sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=" crossorigin="anonymous"></script>
    <script src="jquery.mousewheel.min.js"></script>
    <script src="svg-pan-zoom.min.js"></script>
    <script src="raphael.min.js"></script>
  </head>
  <body>
    <div id="container" style="width: 300px; height: 300px; border:1px solid black; ">
    </div>
<script>
var paper = Raphael('container');

var count = 1;
function createBoundary(paper, title, scale, x, y) {

  var sysrectangle = paper.rect(x, y, 120, 120, 2);
  sysrectangle.attr('stroke-width', scale);

  var t = paper.text(x + 1, y + 8, title);
  t.attr('font-size', 14);
  t.attr('text-anchor', 'start');

  var st = paper.set();
  st.push(
      t,
      sysrectangle
  );
  st.scale(scale, scale, 0, 0);
//  st.attr('class', 'sys');
  count++;

  st.setOpacity = function(zoom) {
    var opacity = (1 - Math.abs(1 - scale - zoom) / 2) - .2;
    console.log(opacity);
    // if (opacity < 0) {
    //   st.hide();
    // }
    // else {
    //   st.show();
    // }
    st.attr('opacity', opacity);
  }
  return st;
}

var boundaries = [];
boundaries.push(createBoundary(paper, "System", 1, 0, 0));
var comp1 = createBoundary(paper, "Comp 1", .4, 0, 0);
comp1.translate(10, 50);
boundaries.push(comp1);
var comp2 = createBoundary(paper, "Comp 2", .4, 0, 0);
comp2.translate(150, 50);
boundaries.push(comp2);
var subcomp = createBoundary(paper, "Sub-Comp 1", .12, 0, 0);
subcomp.translate(50, 250);
boundaries.push(subcomp);
//boundaries.push(createBoundary(paper, "Comp 2", .5, 36, 18));
//boundaries.push(createBoundary(paper, "Sub-Comp 1", .25, 10, 18));

var comp1lay = 1.1;
var syslay = 0;
var innerlay = 2.0;
$(function() {
  var sysrect;


  panZoomInstance = svgPanZoom(paper.canvas, {
    zoomEnabled: true,
    controlIconsEnabled: true,
    contain: true,
    center: true,
    minZoom: 0.1, 
    maxZoom: 2000, 
    onZoom: function(zoom){
      console.log("zoom=", zoom);
      console.log("log =", Math.log(zoom));
      // if (zoom > 20) {
      //   $("#sysrect").hide();
      //   console.log("removed");
      // }
      // else {
      //   $("#sysrect").show();
      //   console.log("added");
      // }
      zoom = Math.log(zoom);
      //$(".comp1").css({opacity: (1 - Math.abs(comp1lay - zoom) / 2) - .1});
      //$(".sys").css({opacity: (1 - Math.abs(syslay - zoom) / 2) - .1});
      //$(".inner1").css({opacity: (1 - Math.abs(innerlay - zoom) / 2) - .1});

      boundaries.forEach(function(element) {
        element.setOpacity(zoom);
      }, this);
    }
    , zoomScaleSensitivity: 0.3
  });
  
  // zoom out
  panZoomInstance.zoom(0.9);

  $("#move").on("click", function() {
    // Pan by any values from -80 to 80
    panZoomInstance.panBy({x: Math.round(Math.random() * 160 - 80), y: Math.round(Math.random() * 160 - 80)})
  });
})
</script>
  </body>
</html>
